% vim: ts=2:sw=2:tw=80:et
\thispagestyle{fancy}
\pagestyle{fancy}
\section{Global Script}
    Some automatic variables are \symb{duration} and \symb{natural_time}.

  \subsection{Variables} \label{script:variables}
    If you want to use a variable in the waveform element lines, you should
    probably define that variable in the global variables/functions script.  By
    doing so, these variables will be available everywhere and also at any time.
    You can then modify these variables by specifying them as loop variables in
    the loop editor and selecting ``Global''.

    Any valid python expression that can be assigned can be used as a loop
    variable.  For instance, consider the following variables initialized in the
    global script:

    \begin{verbatim}
    Bfield = [0*Gauss, 10*Gauss, 123*Gauss]
    CoilCurrent = 4.2*A
    Frequency = dict( mot = -10*MHz, pgc = -40*MHz, image=0*MHz )
    \end{verbatim}

    These expressions and any valid Python expression involving these variables
    can be used anywhere in Arbwave.

  \subsection{\textbf{Arbwave} Module (virtual)}
  \subsection{\textbf{arbwave} Module}

  \subsection{Experimental Control Loop}
  \subsubsection{Basic Customization}

  \begin{lstlisting}
  class SimpleRun(Arbwave.Runnable):
  	def run(self):
  		Arbwave.update()
  		return 0
  \end{lstlisting}


  \begin{lstlisting}
  Arbwave.add_runnable( 'Simple', SimpleRun() )
  \end{lstlisting}

  \subsection{Advanced Customization}

  \begin{lstlisting}
  class Runnable(object):
    """
    Runnable class to allow more significant complexity during a data run.
  
    This implementation mostly defines the interface that runnables provide, but
    this is also the implementation of the "Default" runnable that is used to
    execute output in continuous mode.
    """
    def extra_data_labels(self):
      """
      Returns list of names of extra results returned by self.run()
      """
      return list()
  
    def onstart(self):
      """
      Executed before the runnable is started.
      """
      pass
  
    def onstop(self):
      """
      Executed after the runnable is stopped.
      """
      pass
  
    def run(self):
      """
      The body of any inner loop.
      """
  	def run(self):
  		Arbwave.update()
  		return 0
  \end{lstlisting}

\section{Local Scripts}
In addition to executing scripts that affect the entire experiment globally, it
is also possible to exucute scripts that have as narrow a scope as a group.  In
order to specify a local script, the group menu is used to select \textbf{Local
Script}.  Saving the local script will cause it to be immediately executed as
the entire waveform is updated.  Each additional waveform update will cause a
local script to execute.
